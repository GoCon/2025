---
import { Image } from "astro:assets";
import { getRelativeLocaleUrl } from "astro:i18n";
import sessions from "../data/sessions.json";
import {
  getFormattedTime,
  getSessionRoom,
  getSessionSpeakerName,
  getSessionSpeakerThumbnailSrc,
  getSessionTime,
} from "../utils/timetable";

interface Props {
  /**
   * セッションのID
   * @example 649102
   */
  id: string;
  /**
   * セッションの識別子
   * @example A1-SP
   */
  sessionLabel: string;
}

const { id, sessionLabel } = Astro.props;

const currentLocale = Astro.currentLocale || "ja";

// 現在のセッションを取得
const session = sessions.sessions.find((session) => session.id === id);

if (!session) return null;
---

<style>
  .timetable-card {
    display: flex;
    flex-direction: column;
    width: 100%;
    gap: 4px;
    padding: 16px 24px;
    border-radius: 16px;
    background-color: var(--primitive-light-cyan);
    color: var(--text-primary);
    height: 100%;
    box-sizing: border-box;

    &.room-a {
      background-color: var(--primitive-light-blue);
    }
  }

  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .card-header-time {
    margin: 0;
    font-size: 12px;
    font-weight: 700;
  }

  .card-header-session-id {
    margin: 0;
    padding: 4px 16px;
    border-radius: 24px;
    font-size: 12px;
    font-weight: 700;
    color: var(--text-on-fill);
    background-color: var(--primitive-cyan);

    &.room-a {
      background-color: var(--primitive-blue);
    }
  }

  .card-title {
    margin: 0;
    font-size: 16px;
    font-weight: 700;
    line-height: 1.75;
  }

  .card-title-link {
    color: var(--text-primary);
    text-decoration: none;
  }

  .card-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .speaker-info {
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .speaker-thumbnail {
    width: 24px;
    height: 24px;
    object-fit: cover;
    border-radius: 50%;
  }

  .speaker-name {
    margin: 0;
    font-size: 12px;
    font-weight: 700;
  }

  .session-time {
    margin: 0;
    font-size: 12px;
  }
</style>

<section
  class={`timetable-card ${getSessionRoom(session.roomId) === "RoomA" ? "room-a" : "room-b"}`}
>
  <div class="card-header">
    <p class="card-header-time">
      {getFormattedTime(session.startsAt)} - {getFormattedTime(session.endsAt)}
    </p>
    <p
      class={`card-header-session-id ${getSessionRoom(session.roomId) === "RoomA" ? "room-a" : "room-b"}`}
    >
      {sessionLabel}
    </p>
  </div>
  <h3 class="card-title">
    <a
      href={getRelativeLocaleUrl(currentLocale, `/timetable/${id}`)}
      class="card-title-link">{session.title}</a
    >
  </h3>
  <div class="card-footer">
    <div class="speaker-info">
      <Image
        src={getSessionSpeakerThumbnailSrc(session.speakers.at(0))}
        alt={getSessionSpeakerName(session.speakers.at(0))}
        width={24}
        height={24}
        loading="lazy"
        class="speaker-thumbnail"
      />
      <p class="speaker-name">
        {getSessionSpeakerName(session.speakers.at(0))}
      </p>
    </div>
    <p class="session-time">{getSessionTime(session.categoryItems)}</p>
  </div>
</section>
